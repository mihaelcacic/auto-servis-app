services:
  # Proxies requests to internal services
  reverse-proxy:
    image: nginx:1.29.2-alpine
    container_name: reverse_proxy_demo

    # TODO: Add services that depend on nginx or vice versa
    # depends_on:.......

    # overwriting default nginx configuration
    volumes:
      - ./reverse_proxy/nginx.conf:/etc/nginx/nginx.conf
    ports:
      - 80:80

  backendserver:
    build:
      context: backend-docker/server
      dockerfile: backend.Dockerfile
    image: backend-service:latest
    ports:
      - "127.0.0.2:8080:8080"
  frontend:
    env_file:
      - .env.dev
    environment:
      - DOCKER_ENV=true
    build:
      context: ./frontend
      dockerfile: frontend.Dockerfile
      args:
        - PORT=${WEB_PORT}
    image: web-service:latest
    ports:
      - "${LOCAL_DEV_HOST}:${WEB_PORT}:${WEB_PORT}"
    restart: unless-stopped
